- from:
    uri: direct:product
    steps:
      - onCompletion:
          steps:
            - process:
                ref: requestLogProcessor
            - choice:
                when:
                - simple: ${exchangeProperty.result} == 'Success'
                  steps:
                    - log: "Property is Success"
                    - to:
                        uri: kafka:LogTopic1
                otherwise:
                  steps:
                    - log: "Property is Error"
                    - to:
                        uri: kafka:LogTopic2
      - onException:
          exception: java.lang.Exception
          handled:
            constant: true
          steps:
            - setProperty:
                name: result
                simple: "Error"
      - process:
          ref: SelectProduct
      - log: "kafka 전송완료. ${body}, Type: ${body.getClass}"

- from:
    uri: direct:cart
    steps:
      - onCompletion:
          steps:
            - process:
                ref: requestLogProcessor
            - choice:
                when:
                  - simple: ${exchangeProperty.result} == 'Success'
                    steps:
                      - log: "Property is Success"
                      - to:
                          uri: kafka:LogTopic1
                otherwise:
                  steps:
                    - log: "Property is Error"
                    - to:
                        uri: kafka:LogTopic2
      - onException:
          exception: java.lang.Exception
          handled:
            constant: true
          steps:
            - setProperty:
                name: result
                simple: "Error"
      - process:
          ref: SelectCart
      - log: "kafka 전송완료. ${body}, Type: ${body.getClass}"

- from:
    uri: direct:order
    steps:
      - onCompletion:
          steps:
            - process:
                ref: requestLogProcessor
            - choice:
                when:
                  - simple: ${exchangeProperty.result} == 'Success'
                    steps:
                      - log: "Property is Success"
                      - to:
                          uri: kafka:LogTopic1
                otherwise:
                  steps:
                    - log: "Property is Error"
                    - to:
                        uri: kafka:LogTopic2
      - onException:
          exception: java.lang.Exception
          handled:
            constant: true
          steps:
            - setProperty:
                name: result
                simple: "Error"
      - process:
          ref: OrderService
      - log: "kafka 전송완료. ${body}, Type: ${body.getClass}"